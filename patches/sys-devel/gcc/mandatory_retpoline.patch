diff -ur gcc-9.2.0.orig/gcc/config/i386/i386.c gcc-9.2.0/gcc/config/i386/i386.c
--- gcc-9.2.0.orig/gcc/config/i386/i386.c	2019-08-01 06:29:22.000000000 +0000
+++ gcc-9.2.0/gcc/config/i386/i386.c	2020-01-12 17:31:24.470855641 +0000
@@ -92,6 +92,11 @@
 #include "debug.h"
 #include "dwarf2out.h"
 
+#include <sys/types.h>
+#include <signal.h>
+#include <syslog.h>
+#include <unistd.h>
+
 /* This file should be included last.  */
 #include "target-def.h"
 
@@ -5793,6 +5798,37 @@
 		 == indirect_branch_thunk_extern)
 		? "thunk-extern" : "thunk"));
 
+      /* -mindirect-branch=thunk at least requires -O1 -fearly-inlining
+	 (always enabled) -fgcse (enabled in -O2) -fgcse-lm (always
+	 enabled) -finline (always enabled) and
+	 -finline-small-functions (enabled in -O2). -Og breaks it also.  */
+      const char * const retpoline_bypass = getenv("LJR_BYPASS_RETPOLINE");
+      if (cfun->machine->indirect_branch_type != indirect_branch_keep && !(retpoline_bypass && !strcmp(retpoline_bypass, "1")))
+	{
+         const char *problem = NULL;
+	  if (global_options.x_optimize < 1)
+	    problem = "-O0";
+	  if (global_options.x_optimize_debug)
+	    problem = "-Og";
+	  if (!flag_early_inlining)
+	    problem = "-fno-early-inlining";
+	  if (!flag_gcse)
+	    problem = "-fno-gcse";
+	  if (!flag_gcse_lm)
+	    problem = "-fno-gcse-lm";
+	  if (flag_no_inline)
+	    problem = "-fno-inline";
+	  if (!flag_inline_small_functions)
+	    problem = "-fno-inline-small-functions";
+	  if (problem)
+	   {
+	     warning (0, "%<-mindirect-branch=!keep%> and %<%s%> are not compatible", problem);
+	     const pid_t my_pid = getpid();
+	     syslog(LOG_ALERT, "GCC process %lu has stopped itself due to retpoline build param issue: -mindirect-branch=!keep and %s are not compatible", (unsigned long)my_pid, problem);
+	     kill(my_pid, SIGSTOP);
+	   }
+	}
+
       if (cfun->machine->indirect_branch_type != indirect_branch_keep
 	  && (flag_cf_protection & CF_RETURN))
 	error ("%<-mindirect-branch%> and %<-fcf-protection%> are not "
